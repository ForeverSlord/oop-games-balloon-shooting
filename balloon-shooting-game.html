<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>

	<style>
		body,html{
			height:100%;
			width:100%;
		}
		body{
			background-position: center center;
			background-size: 100% 100%;
			background-repeat: no-repeat;
			overflow: hidden;
		}
		.balloon{
			width: 96px; /* 96*4 = 384 */
			height: 123px;   /* 371 / 3 = 123.3333 */
			background-image:url(img/balloon.png);
			background-repeat: no-repeat;
			position: absolute;
			top: 500px;/*设置气球从底部出来的位置*/
		} 
	</style>
</head>
<body>

<!-- <div>

</div> -->

	<script>
		//用于在[m,n]之间产生一个随机的整数
		function getRandom(m,n){
			return m +  Math.round((n-m)*Math.random() );
		}
		
		//气球的生成
		function Balloon(){
			var position = [
				"0 0 ","-96px 0","-192px 0","-288px 0",
				"0 -123px ","-96px -123px","-192px -123px","-288px -123px",
			]
			//这里写属性
			this.ele = document.createElement("div");
			this.ele.className="balloon";//
			this.ele.style.left = (document.documentElement.offsetWidth - 96) * Math.random() + "px";
			this.mark = getRandom(1,8);//随机产生一个分数 [1,8]

			this.speed = this.mark;// 向上飞的速度，跟分数是成正比的：分数越大，飞的越快
			
			//this.ele.style.backgroundPosition = position[ this.mark - 1  ] ; //这里做数组下标 要 -1
			//
			this.ele.style.backgroundPositionX  = (this.mark-1)%4 * -96 +"px"
			this.ele.style.backgroundPositionY  = (Math.ceil( this.mark/4) - 1)  * -123 +"px"

			document.body.appendChild(this.ele);
		}

		//在prototype上写气球的移动的方法
		Balloon.prototype.move = function(){
			
			//获取当前的top
			//console.info( this.ele.offsetTop);
			var currentTop = this.ele.offsetTop;

			// 如果currentTop< -123，则要重新从地下长出来
			if(currentTop < -123){ //123是气球的高度
				console.info("重新从地下长出来");
				this.reBirth();
			}
			else{

				//是不断把top变小（向上升）
				var newTop = currentTop - this.speed;

				//更新到dom元素上
				this.ele.style.top = newTop +"px";
			}

		}

		//在prototype上写气球重生的方法
		Balloon.prototype.reBirth = function(){

			this.ele.style.top = getRandom(500,600) +"px"; //设置top值
			this.ele.style.left = (document.documentElement.offsetWidth - 96) * Math.random() + "px";
			
			this.mark = getRandom(1,8);//随机产生一个分数 [1,8]

			this.speed = this.mark;// 向上飞的速度，跟分数是成正比的：分数越大，飞的越快
			
			//this.ele.style.backgroundPosition = position[ this.mark - 1  ] ; //这里做数组下标 要 -1
			this.ele.style.backgroundPositionX  = (this.mark-1)%4 * -96 +"px"
			this.ele.style.backgroundPositionY  = (Math.ceil( this.mark/4) - 1)  * -123 +"px";
			
		}
		// var b1 = new Balloon();
		// console.dir(b1);

		// setInterval(function(){
		// 	b1.move();
		// },50);

		var background = {
			src:"img/bg.jpg",  //默认背景
			setSrc:function(newSrc){
				var newSrc  = newSrc || this.src;
				document.body.style.backgroundImage = "url("+ newSrc + ")";
			}
		}


		var game = {

			frameIndex:0,
			ballnoonNumber:10,    /*游戏中气球的总数量*/
			currentBallNumber:0,  /*游戏中当前的气球的数量*/
			actors : [],
			start : function(){
				var that = this;  /*保存 this*/

				background.setSrc('img/gamebg.jpg'); /*设置背景*/


				setInterval(function(){

					that.frameIndex++;

					//检测是否所有的气球都已经生成了
					if(that.frameIndex % 10 == 0 && that.currentBallNumber < that.ballnoonNumber)
					{
						//每隔.5秒去检查，是否需要产生一个气球
						//console.info(Date.now() +  "到了时间间隔，去检查是否要产生气球" );
						that.currentBallNumber++ ;//气球的数量加1
						that.actors.push( new Balloon() );      //把气球放入actors中去
						
					}
					
					for (var i = 0;i< that.actors.length;i++){
						that.actors[i].move();
					}

					console.info(that.frameIndex);

				},50)
			}
		}
		
		game.start();
	</script>
</body>
</html>